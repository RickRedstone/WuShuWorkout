<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wushu Workout Tracker</title>
    
    <!-- PWA Meta Tags -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#feca57">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Wushu Tracker">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #ff6b6b, #feca57);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            color: #aaa;
            font-size: 1.1em;
        }

        .session-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .session-card {
            background: rgba(255, 255, 255, 0.08);
            padding: 25px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
        }

        .session-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #ff6b6b, #feca57);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .session-card:hover::before {
            transform: scaleX(1);
        }

        .session-card:hover {
            background: rgba(255, 255, 255, 0.12);
            transform: translateY(-5px);
        }

        .session-card.active {
            border-color: #feca57;
            background: rgba(254, 202, 87, 0.15);
        }

        .session-title {
            font-size: 1.5em;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .session-desc {
            color: #bbb;
            font-size: 0.9em;
            margin-bottom: 15px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            margin-top: 15px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff6b6b, #feca57);
            width: 0%;
            transition: width 0.3s ease;
        }

        .workout-area {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .workout-area.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .exercise-card {
            background: rgba(255, 255, 255, 0.08);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 25px;
            border-left: 4px solid #feca57;
        }

        .exercise-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .exercise-name {
            font-size: 1.8em;
            font-weight: bold;
        }

        .exercise-number {
            background: #feca57;
            color: #1a1a2e;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
        }

        .why-section {
            background: rgba(255, 107, 107, 0.1);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 3px solid #ff6b6b;
        }

        .why-title {
            color: #ff6b6b;
            font-weight: bold;
            margin-bottom: 8px;
            font-size: 1.1em;
        }

        .cues-section {
            background: rgba(254, 202, 87, 0.1);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 3px solid #feca57;
        }

        .cues-title {
            color: #feca57;
            font-weight: bold;
            margin-bottom: 8px;
            font-size: 1.1em;
        }

        .cues-list {
            list-style: none;
            padding-left: 0;
        }

        .cues-list li {
            padding: 5px 0;
            padding-left: 20px;
            position: relative;
        }

        .cues-list li::before {
            content: '‚Üí';
            position: absolute;
            left: 0;
            color: #feca57;
        }

        .video-container {
            position: relative;
            padding-bottom: 56.25%;
            height: 0;
            overflow: hidden;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 12px;
        }

        .sets-tracker {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .sets-title {
            font-size: 1.1em;
            margin-bottom: 15px;
            color: #bbb;
        }

        .set-controls {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .set-button {
            flex: 1;
            min-width: 100px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: #fff;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1em;
            font-weight: bold;
        }

        .set-button:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: scale(1.05);
        }

        .set-button.completed {
            background: linear-gradient(45deg, #00d2ff, #3a7bd5);
            border-color: #00d2ff;
        }

        .timer-section {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 20px;
        }

        .timer-display {
            font-size: 3em;
            font-weight: bold;
            color: #feca57;
            margin-bottom: 15px;
        }

        .timer-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .timer-button {
            padding: 12px 24px;
            background: rgba(254, 202, 87, 0.2);
            border: 2px solid #feca57;
            border-radius: 8px;
            color: #feca57;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .timer-button:hover {
            background: #feca57;
            color: #1a1a2e;
        }

        .navigation {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        .nav-button {
            flex: 1;
            padding: 15px;
            background: linear-gradient(45deg, #ff6b6b, #feca57);
            border: none;
            border-radius: 8px;
            color: #fff;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .nav-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(254, 202, 87, 0.4);
        }

        .nav-button.secondary {
            background: rgba(255, 255, 255, 0.1);
        }

        .warm-up-section {
            background: rgba(0, 210, 255, 0.1);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 30px;
            border-left: 4px solid #00d2ff;
        }

        .warm-up-title {
            color: #00d2ff;
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .warm-up-list {
            list-style: none;
            padding-left: 0;
        }

        .warm-up-list li {
            padding: 8px 0;
            padding-left: 25px;
            position: relative;
        }

        .warm-up-list li::before {
            content: 'üî•';
            position: absolute;
            left: 0;
        }

        .stats-panel {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 30px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .stat-item {
            text-align: center;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #feca57;
        }

        .stat-label {
            color: #bbb;
            font-size: 0.9em;
            margin-top: 5px;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.8em;
            }

            .exercise-name {
                font-size: 1.3em;
            }

            .timer-display {
                font-size: 2em;
            }

            .set-controls {
                flex-direction: column;
            }

            .set-button {
                min-width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ü•ã Wushu Workout Tracker</h1>
            <p class="subtitle">Kraft & Power f√ºr Kampfkunst | Optimiert f√ºr 48+</p>
        </header>

        <div class="stats-panel" id="statsPanel">
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-value" id="totalWorkouts">0</div>
                    <div class="stat-label">Workouts</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="totalSets">0</div>
                    <div class="stat-label">Sets absolviert</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="currentStreak">0</div>
                    <div class="stat-label">Tage Streak</div>
                </div>
            </div>
        </div>

        <div class="session-selector" id="sessionSelector">
            <div class="session-card" data-session="lower">
                <div class="session-title">Tag 1: Lower Body</div>
                <div class="session-desc">Power & Stabilit√§t | 5 √úbungen</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressLower"></div>
                </div>
            </div>
            <div class="session-card" data-session="upper">
                <div class="session-title">Tag 2: Upper Body</div>
                <div class="session-desc">Kraft & Koordination | 4 √úbungen</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressUpper"></div>
                </div>
            </div>
        </div>

        <div class="workout-area" id="workoutArea">
            <!-- Dynamic workout content will be inserted here -->
        </div>
    </div>

    <script>
        // Workout data structure
        const workouts = {
            lower: {
                name: "Lower Body Power & Joint Control",
                warmup: [
                    "Joint Circles: H√ºfte, Knie, Sprunggelenke (je 10x pro Richtung)",
                    "Leg Swings: Front/Back & Side/Side (je 10x pro Bein)",
                    "Cat-Cow: 10 Wiederholungen",
                    "World's Greatest Stretch: 5x pro Seite",
                    "Horse Stance Transitions: 2min"
                ],
                exercises: [
                    {
                        name: "Kettlebell Swing",
                        sets: "3-5 S√§tze √ó 8-10 Reps",
                        why: "Trainiert explosive H√ºftkraft (posterior chain) ‚Äì essentiell f√ºr Spr√ºnge und Kicks. Verbessert nachweislich rate of force development.",
                        cues: [
                            "H√ºfte schnalzt nach vorne, Arme sind nur Haken",
                            "Neutrale Wirbels√§ule, Rippen runter",
                            "Kettlebell schwebt ‚Äì nicht aktiv heben"
                        ],
                        video: "YSxHifyI6s8"
                    },
                    {
                        name: "Cable Step-Back Lunge",
                        sets: "3 S√§tze √ó 6-8 Reps pro Seite",
                        why: "Baut exzentrische Kontrolle (Bremskraft) auf. Verbessert Knie- & H√ºftstabilit√§t f√ºr sichere Landungen.",
                        cues: [
                            "Schritt zur√ºck sanft",
                            "Vorderes Knie trackt √ºber Zehen",
                            "Kabel h√§lt konstante Spannung ‚Äì gegen Rotation arbeiten"
                        ],
                        video: "F8dZ8G6H7gY"
                    },
                    {
                        name: "Bulgarian Split Squat",
                        sets: "3 S√§tze √ó 6-8 Reps pro Seite",
                        why: "Unilaterale Kraft = Balance + Koordination. Reduziert Asymmetrien in Unterk√∂rperkraft.",
                        cues: [
                            "Hinterer Fu√ü entspannt, nicht eingeklemmt",
                            "Leichte Vorw√§rtsneigung im Oberk√∂rper",
                            "Durch Mittelfu√ü dr√ºcken"
                        ],
                        video: "2C-uNgKwPLE"
                    },
                    {
                        name: "Single-Leg Kettlebell RDL",
                        sets: "3 S√§tze √ó 6-8 Reps pro Seite",
                        why: "H√ºftkontrolle + Balance + Hamstrings. Reduziert Verletzungsrisiko und verbessert Verwurzelung.",
                        cues: [
                            "Lange Wirbels√§ule, H√ºfte bleibt quadratisch",
                            "Mit freiem Bein nach hinten greifen",
                            "Langsam und kontrolliert bewegen"
                        ],
                        video: "4ZeY3Xr4T1k"
                    },
                    {
                        name: "Cable Woodchop (High ‚Üí Low)",
                        sets: "3 S√§tze √ó 8-10 Reps pro Seite",
                        why: "Rotationskraft im Core ‚Äì essentiell f√ºr Schl√§ge, Drehungen und Spins. Trainiert Energietransfer von Beinen ‚Üí Torso ‚Üí Armen.",
                        cues: [
                            "H√ºfte dreht zuerst",
                            "Arme bleiben lang",
                            "R√ºckkehr kontrollieren (exzentrisch!)"
                        ],
                        video: "oL7exAOo_0I"
                    }
                ]
            },
            upper: {
                name: "Upper Body Integrated Strength",
                warmup: [
                    "Schulterkreise: 10x vorw√§rts, 10x r√ºckw√§rts",
                    "Band Pull-Aparts: 2 √ó 15 Reps",
                    "Scapular Push-Ups: 2 √ó 10 Reps",
                    "Thread the Needle: 5x pro Seite",
                    "Arm Circles: Klein ‚Üí Gro√ü, je 30 Sekunden"
                ],
                exercises: [
                    {
                        name: "Dumbbell Push-Up to Row",
                        sets: "3 S√§tze √ó 6-8 Reps pro Seite",
                        why: "Push + Pull + Core in einem Pattern. Verbessert Cross-Body-Koordination. Schulterfreundlich.",
                        cues: [
                            "Breite Basis mit den F√º√üen",
                            "Keine H√ºftrotation bei den Rows",
                            "Langsam bewegen, saubere Reps"
                        ],
                        video: "3WUtJxLv-wI"
                    },
                    {
                        name: "Cable Face Pull (with External Rotation)",
                        sets: "3 S√§tze √ó 12-15 Reps",
                        why: "Schultergesundheit (mega wichtig f√ºr Schlag-Kampfk√ºnste). Verbessert Haltung und Skapulakontrolle.",
                        cues: [
                            "Auf Gesichtsh√∂he ziehen",
                            "Ellbogen hoch, nach au√üen rotieren",
                            "Pause am Ende der Bewegung"
                        ],
                        video: "rep-qVOkqgk"
                    },
                    {
                        name: "Dumbbell Incline Bench Press",
                        sets: "3 S√§tze √ó 8-10 Reps",
                        why: "Funktionaler Dr√ºckwinkel. Bessere Schultermechanik als flache Bank. Unterst√ºtzt Druckkraft ohne Steifheit.",
                        cues: [
                            "Schulterbl√§tter leicht zur√ºckgezogen",
                            "Abstieg kontrollieren",
                            "Kein Abfedern"
                        ],
                        video: "8iPEnn-ltC8"
                    },
                    {
                        name: "Kettlebell Overhead Carry",
                        sets: "3 S√§tze √ó 30-40m pro Arm",
                        why: "Core + Schulterstabilit√§t unter Last. Verbessert direkt √úberkopfkontrolle und Haltung.",
                        cues: [
                            "Bizeps am Ohr",
                            "Rippen runter, kein Lehnen",
                            "Langsam und stolz gehen"
                        ],
                        video: "6Rz8H8Dk8nM"
                    }
                ]
            }
        };

        // State management
        let currentSession = null;
        let currentExercise = 0;
        let completedSets = {};
        let timerInterval = null;
        let timerSeconds = 0;
        let stats = JSON.parse(localStorage.getItem('wushuStats')) || {
            totalWorkouts: 0,
            totalSets: 0,
            lastWorkout: null,
            sessionProgress: { lower: {}, upper: {} }
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            updateStatsDisplay();
            updateProgressBars();
            initSessionSelector();
            
            // Service Worker disabled for debugging
            // Enable later when everything works
        });

        function initSessionSelector() {
            document.querySelectorAll('.session-card').forEach(card => {
                card.addEventListener('click', () => {
                    const session = card.dataset.session;
                    startWorkout(session);
                });
            });
        }

        function startWorkout(session) {
            currentSession = session;
            currentExercise = 0;
            completedSets = {};
            
            document.getElementById('sessionSelector').style.display = 'none';
            document.getElementById('workoutArea').classList.add('active');
            
            renderWorkout();
        }

        function renderWorkout() {
            const workout = workouts[currentSession];
            const area = document.getElementById('workoutArea');
            
            let html = `
                <div class="warm-up-section">
                    <div class="warm-up-title">üî• Warm-Up (10 Minuten)</div>
                    <ul class="warm-up-list">
                        ${workout.warmup.map(item => `<li>${item}</li>`).join('')}
                    </ul>
                </div>
            `;

            if (currentExercise < workout.exercises.length) {
                const exercise = workout.exercises[currentExercise];
                const exerciseKey = `${currentSession}-${currentExercise}`;
                const setsCount = parseInt(exercise.sets.split('√ó')[0].split('-')[0].trim());
                
                html += `
                    <div class="exercise-card">
                        <div class="exercise-header">
                            <div class="exercise-name">${exercise.name}</div>
                            <div class="exercise-number">${currentExercise + 1}/${workout.exercises.length}</div>
                        </div>

                        <div class="why-section">
                            <div class="why-title">üí° Warum diese √úbung?</div>
                            <p>${exercise.why}</p>
                        </div>

                        <div class="video-container">
                            <iframe 
                                src="https://www.youtube.com/embed/${exercise.video}" 
                                frameborder="0" 
                                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                                allowfullscreen>
                            </iframe>
                        </div>

                        <div class="cues-section">
                            <div class="cues-title">üéØ Ausf√ºhrungs-Cues</div>
                            <ul class="cues-list">
                                ${exercise.cues.map(cue => `<li>${cue}</li>`).join('')}
                            </ul>
                        </div>

                        <div class="sets-tracker">
                            <div class="sets-title">S√§tze: ${exercise.sets}</div>
                            <div class="set-controls" id="setControls">
                                ${Array.from({length: setsCount}, (_, i) => `
                                    <button class="set-button" onclick="toggleSet('${exerciseKey}', ${i})">
                                        Satz ${i + 1}
                                    </button>
                                `).join('')}
                            </div>
                        </div>

                        <div class="timer-section">
                            <div class="timer-display" id="timerDisplay">00:00</div>
                            <div class="timer-controls">
                                <button class="timer-button" onclick="startTimer()">Start</button>
                                <button class="timer-button" onclick="pauseTimer()">Pause</button>
                                <button class="timer-button" onclick="resetTimer()">Reset</button>
                            </div>
                        </div>

                        <div class="navigation">
                            ${currentExercise > 0 ? 
                                '<button class="nav-button secondary" onclick="previousExercise()">‚Üê Zur√ºck</button>' : 
                                '<button class="nav-button secondary" onclick="backToMenu()">‚Üê Men√º</button>'}
                            <button class="nav-button" onclick="nextExercise()">
                                ${currentExercise < workout.exercises.length - 1 ? 'Weiter ‚Üí' : 'Fertig üéâ'}
                            </button>
                        </div>
                    </div>
                `;
            }

            area.innerHTML = html;
            updateSetButtons();
        }

        function toggleSet(exerciseKey, setIndex) {
            if (!completedSets[exerciseKey]) {
                completedSets[exerciseKey] = [];
            }
            
            const index = completedSets[exerciseKey].indexOf(setIndex);
            if (index > -1) {
                completedSets[exerciseKey].splice(index, 1);
            } else {
                completedSets[exerciseKey].push(setIndex);
                stats.totalSets++;
            }
            
            updateSetButtons();
            saveStats();
        }

        function updateSetButtons() {
            const exerciseKey = `${currentSession}-${currentExercise}`;
            const completed = completedSets[exerciseKey] || [];
            
            document.querySelectorAll('.set-button').forEach((btn, index) => {
                if (completed.includes(index)) {
                    btn.classList.add('completed');
                } else {
                    btn.classList.remove('completed');
                }
            });
        }

        function nextExercise() {
            const workout = workouts[currentSession];
            
            if (currentExercise < workout.exercises.length - 1) {
                currentExercise++;
                renderWorkout();
                window.scrollTo(0, 0);
            } else {
                completeWorkout();
            }
        }

        function previousExercise() {
            if (currentExercise > 0) {
                currentExercise--;
                renderWorkout();
                window.scrollTo(0, 0);
            }
        }

        function completeWorkout() {
            stats.totalWorkouts++;
            stats.lastWorkout = new Date().toISOString();
            saveStats();
            
            // Show cool-down selection
            showCoolDownSelection();
        }

        function backToMenu() {
            currentSession = null;
            currentExercise = 0;
            resetTimer();
            
            document.getElementById('sessionSelector').style.display = 'grid';
            document.getElementById('workoutArea').classList.remove('active');
            
            updateStatsDisplay();
            updateProgressBars();
        }

        // Timer functions
        function startTimer() {
            if (!timerInterval) {
                timerInterval = setInterval(() => {
                    timerSeconds++;
                    updateTimerDisplay();
                }, 1000);
            }
        }

        function pauseTimer() {
            clearInterval(timerInterval);
            timerInterval = null;
        }

        function resetTimer() {
            pauseTimer();
            timerSeconds = 0;
            updateTimerDisplay();
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timerSeconds / 60);
            const seconds = timerSeconds % 60;
            const display = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            const timerEl = document.getElementById('timerDisplay');
            if (timerEl) timerEl.textContent = display;
        }

        // Stats functions
        function updateStatsDisplay() {
            document.getElementById('totalWorkouts').textContent = stats.totalWorkouts;
            document.getElementById('totalSets').textContent = stats.totalSets;
            
            const streak = calculateStreak();
            document.getElementById('currentStreak').textContent = streak;
        }

        function calculateStreak() {
            if (!stats.lastWorkout) return 0;
            
            const lastDate = new Date(stats.lastWorkout);
            const today = new Date();
            const diffTime = Math.abs(today - lastDate);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            return diffDays <= 1 ? 1 : 0;
        }

        function updateProgressBars() {
            ['lower', 'upper'].forEach(session => {
                const progress = calculateSessionProgress(session);
                document.getElementById(`progress${session.charAt(0).toUpperCase() + session.slice(1)}`).style.width = `${progress}%`;
            });
        }

        function calculateSessionProgress(session) {
            const workout = workouts[session];
            const totalExercises = workout.exercises.length;
            let completed = 0;
            
            workout.exercises.forEach((ex, index) => {
                const key = `${session}-${index}`;
                if (completedSets[key] && completedSets[key].length > 0) {
                    completed++;
                }
            });
            
            return (completed / totalExercises) * 100;
        }

        function saveStats() {
            localStorage.setItem('wushuStats', JSON.stringify(stats));
        }

        // Cool-Down System
        const coolDownPrograms = {
            express: {
                name: "Express Cool-Down",
                duration: "10-15 Min",
                description: "Schnell & effektiv ‚Äì wenn du wenig Zeit hast",
                phases: [
                    {
                        name: "Cardio Cool-Down",
                        duration: 300,
                        instructions: [
                            "Gehen, Rad oder Rudern bei 50% Intensit√§t",
                            "Senkt Herzrate graduell",
                            "F√∂rdert Laktat-Clearance"
                        ]
                    },
                    {
                        name: "Statisches Stretching",
                        duration: 420,
                        exercises: [
                            { name: "H√ºftbeuger (Couch Stretch)", duration: 90, perSide: true },
                            { name: "Hamstrings (Forward Fold)", duration: 120, perSide: false },
                            { name: "Schultern (Cross-Body)", duration: 60, perSide: true },
                            { name: "Thoracic Spine (Thread Needle)", duration: 60, perSide: true },
                            { name: "Adduktoren (Wide Squat)", duration: 90, perSide: false }
                        ]
                    },
                    {
                        name: "Box Breathing",
                        duration: 180,
                        type: "breathing",
                        pattern: { inhale: 4, hold1: 4, exhale: 4, hold2: 4 }
                    }
                ]
            },
            deluxe: {
                name: "Regeneration Deluxe",
                duration: "30-40 Min",
                description: "Maximale Recovery mit Pool & Sauna",
                phases: [
                    {
                        name: "Aqua-Mobilit√§t",
                        duration: 300,
                        instructions: [
                            "Leg Swings im Wasser",
                            "Hip Circles",
                            "Arm Circles",
                            "Spine Rotations"
                        ]
                    },
                    {
                        name: "Easy Swimming",
                        duration: 600,
                        instructions: [
                            "Kraul oder Brust bei 60% Effort",
                            "Keine Sprints, nur Flow",
                            "F√∂rdert Durchblutung"
                        ]
                    },
                    {
                        name: "Kontrast-Therapie Zyklus 1",
                        duration: 600,
                        instructions: [
                            "üî• Sauna: 8-10min (80-90¬∞C)",
                            "üßä Kalt duschen/Pool: 2-3min"
                        ]
                    },
                    {
                        name: "Kontrast-Therapie Zyklus 2",
                        duration: 600,
                        instructions: [
                            "üí® Dampfbad: 8-10min",
                            "üßä Kalt duschen/Pool: 2-3min"
                        ]
                    },
                    {
                        name: "Foam Rolling",
                        duration: 300,
                        instructions: [
                            "IT-Band: 60sec pro Seite",
                            "Quads: 60sec pro Seite",
                            "Glutes/Lats: 60sec pro Seite"
                        ]
                    }
                ]
            },
            mobility: {
                name: "Mobility & Meditation",
                duration: "20-25 Min",
                description: "Mental runterfahren + Deep Stretching",
                phases: [
                    {
                        name: "Qigong Flow",
                        duration: 300,
                        instructions: [
                            "Cloud Hands: 2min",
                            "Silk Reeling: 2min",
                            "Standing Wave: 1min"
                        ]
                    },
                    {
                        name: "Yin Stretching",
                        duration: 720,
                        exercises: [
                            { name: "Dragon Pose", duration: 120, perSide: true },
                            { name: "Pigeon Pose", duration: 120, perSide: true },
                            { name: "Saddle Pose", duration: 180, perSide: false },
                            { name: "Child's Pose Seitneigung", duration: 90, perSide: true },
                            { name: "Supine Twist", duration: 90, perSide: true },
                            { name: "Legs-Up-The-Wall", duration: 180, perSide: false }
                        ]
                    },
                    {
                        name: "4-7-8 Atmung",
                        duration: 240,
                        type: "breathing",
                        pattern: { inhale: 4, hold1: 7, exhale: 8, hold2: 0 }
                    }
                ]
            }
        };

        let currentCoolDown = null;
        let currentPhase = 0;
        let currentExerciseIndex = 0;
        let coolDownTimer = null;
        let coolDownSeconds = 0;
        let breathingInterval = null;
        let breathingPhase = 'inhale';

        function showCoolDownSelection() {
            const area = document.getElementById('workoutArea');
            
            let html = `
                <div class="exercise-card" style="text-align: center;">
                    <h2 style="margin-bottom: 20px;">üéâ Workout abgeschlossen!</h2>
                    <p style="color: #bbb; margin-bottom: 30px;">
                        Sessions total: ${stats.totalWorkouts} | Sets heute: ${Object.values(completedSets).flat().length}
                    </p>
                    <h3 style="margin-bottom: 25px;">W√§hle dein Cool-Down Programm:</h3>
                    
                    <div class="session-selector">
                        ${Object.keys(coolDownPrograms).map(key => {
                            const program = coolDownPrograms[key];
                            return `
                                <div class="session-card" onclick="startCoolDown('${key}')">
                                    <div class="session-title">${program.name}</div>
                                    <div class="session-desc">${program.description}</div>
                                    <div class="session-desc" style="margin-top: 10px; color: #feca57;">
                                        ‚è±Ô∏è ${program.duration}
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                    
                    <button class="nav-button secondary" onclick="skipCoolDown()" style="margin-top: 30px;">
                        Cool-Down √ºberspringen
                    </button>
                </div>
            `;
            
            area.innerHTML = html;
        }

        function skipCoolDown() {
            alert('üí™ Denk dran: Recovery ist Training!\nN√§chstes Mal g√∂nn dir das Cool-Down üôè');
            backToMenu();
        }

        function startCoolDown(programKey) {
            currentCoolDown = programKey;
            currentPhase = 0;
            currentExerciseIndex = 0;
            renderCoolDownPhase();
        }

        function renderCoolDownPhase() {
            const program = coolDownPrograms[currentCoolDown];
            const phase = program.phases[currentPhase];
            const area = document.getElementById('workoutArea');
            
            let html = `
                <div class="exercise-card">
                    <div class="exercise-header">
                        <div class="exercise-name">${program.name}</div>
                        <div class="exercise-number">Phase ${currentPhase + 1}/${program.phases.length}</div>
                    </div>
                    
                    <div class="why-section">
                        <div class="why-title">${phase.name}</div>
                        <p style="font-size: 1.2em; color: #feca57;">‚è±Ô∏è ${Math.floor(phase.duration / 60)} Minuten</p>
                    </div>
            `;

            if (phase.type === 'breathing') {
                html += renderBreathingExercise(phase);
            } else if (phase.exercises) {
                html += renderStretchingExercises(phase);
            } else {
                html += renderChecklistPhase(phase);
            }

            html += `
                    <div class="navigation">
                        ${currentPhase > 0 ? 
                            '<button class="nav-button secondary" onclick="previousCoolDownPhase()">‚Üê Zur√ºck</button>' : 
                            '<button class="nav-button secondary" onclick="backToCoolDownSelection()">‚Üê Programm wechseln</button>'}
                        <button class="nav-button" onclick="nextCoolDownPhase()">
                            ${currentPhase < program.phases.length - 1 ? 'Weiter ‚Üí' : 'Fertig üéâ'}
                        </button>
                    </div>
                </div>
            `;

            area.innerHTML = html;
            window.scrollTo(0, 0);
        }

        function renderBreathingExercise(phase) {
            const pattern = phase.pattern;
            return `
                <div class="breathing-container" style="text-align: center; padding: 40px; background: rgba(255, 255, 255, 0.05); border-radius: 12px; margin-bottom: 20px;">
                    <div id="breathingCircle" style="width: 200px; height: 200px; margin: 0 auto 30px; border-radius: 50%; background: linear-gradient(45deg, #ff6b6b, #feca57); display: flex; align-items: center; justify-content: center; transition: transform 4s ease;">
                        <div id="breathingText" style="font-size: 2em; font-weight: bold;">Bereit?</div>
                    </div>
                    
                    <div style="margin-bottom: 30px; font-size: 1.2em; color: #bbb;">
                        <p>Einatmen: ${pattern.inhale}s | Halten: ${pattern.hold1}s | Ausatmen: ${pattern.exhale}s${pattern.hold2 > 0 ? ` | Halten: ${pattern.hold2}s` : ''}</p>
                    </div>

                    <div class="timer-display" id="breathingTimer">00:00</div>
                    
                    <div class="timer-controls">
                        <button class="timer-button" onclick="startBreathingExercise(${JSON.stringify(pattern).replace(/"/g, '&quot;')})">Start</button>
                        <button class="timer-button" onclick="stopBreathingExercise()">Stop</button>
                        <button class="timer-button" onclick="resetBreathingExercise()">Reset</button>
                    </div>
                </div>
            `;
        }

        function renderStretchingExercises(phase) {
            const exercise = phase.exercises[currentExerciseIndex];
            const totalExercises = phase.exercises.length;
            
            return `
                <div class="cues-section">
                    <div class="cues-title">Stretch ${currentExerciseIndex + 1}/${totalExercises}: ${exercise.name}</div>
                    <p style="font-size: 1.3em; color: #feca57; margin-top: 10px;">
                        ‚è±Ô∏è ${exercise.duration} Sekunden${exercise.perSide ? ' pro Seite' : ''}
                    </p>
                </div>

                <div class="timer-section">
                    <div class="timer-display" id="stretchTimer">${formatTime(exercise.duration)}</div>
                    <div class="timer-controls">
                        <button class="timer-button" onclick="startStretchTimer(${exercise.duration})">Start</button>
                        <button class="timer-button" onclick="pauseStretchTimer()">Pause</button>
                        <button class="timer-button" onclick="resetStretchTimer(${exercise.duration})">Reset</button>
                    </div>
                </div>

                ${currentExerciseIndex < totalExercises - 1 ? 
                    '<button class="nav-button" onclick="nextStretchExercise()" style="margin-bottom: 20px; width: 100%;">N√§chster Stretch ‚Üí</button>' : 
                    ''}
            `;
        }

        function renderChecklistPhase(phase) {
            return `
                <div class="cues-section">
                    <div class="cues-title">üìã Checklist</div>
                    <ul class="cues-list">
                        ${phase.instructions.map((instruction, i) => `
                            <li>
                                <label style="display: flex; align-items: center; cursor: pointer;">
                                    <input type="checkbox" id="check${i}" style="margin-right: 10px; width: 20px; height: 20px; cursor: pointer;">
                                    ${instruction}
                                </label>
                            </li>
                        `).join('')}
                    </ul>
                </div>

                <div class="timer-section">
                    <div class="timer-display" id="phaseTimer">${formatTime(phase.duration)}</div>
                    <div class="timer-controls">
                        <button class="timer-button" onclick="startPhaseTimer(${phase.duration})">Start</button>
                        <button class="timer-button" onclick="pausePhaseTimer()">Pause</button>
                        <button class="timer-button" onclick="resetPhaseTimer(${phase.duration})">Reset</button>
                    </div>
                </div>
            `;
        }

        // Breathing Exercise Logic
        function startBreathingExercise(pattern) {
            stopBreathingExercise();
            breathingPhase = 'ready';
            coolDownSeconds = 0;
            
            const circle = document.getElementById('breathingCircle');
            const text = document.getElementById('breathingText');
            
            breathingInterval = setInterval(() => {
                const timer = document.getElementById('breathingTimer');
                coolDownSeconds++;
                if (timer) timer.textContent = formatTime(coolDownSeconds);
                
                if (breathingPhase === 'ready') {
                    breathingPhase = 'inhale';
                    text.textContent = 'Einatmen';
                    circle.style.transform = 'scale(1.5)';
                    circle.style.transition = `transform ${pattern.inhale}s ease`;
                    setTimeout(() => { breathingPhase = 'hold1'; }, pattern.inhale * 1000);
                } else if (breathingPhase === 'hold1') {
                    text.textContent = 'Halten';
                    setTimeout(() => { breathingPhase = 'exhale'; }, pattern.hold1 * 1000);
                } else if (breathingPhase === 'exhale') {
                    text.textContent = 'Ausatmen';
                    circle.style.transform = 'scale(1)';
                    circle.style.transition = `transform ${pattern.exhale}s ease`;
                    if (pattern.hold2 > 0) {
                        setTimeout(() => { breathingPhase = 'hold2'; }, pattern.exhale * 1000);
                    } else {
                        setTimeout(() => { breathingPhase = 'inhale'; }, pattern.exhale * 1000);
                    }
                } else if (breathingPhase === 'hold2') {
                    text.textContent = 'Halten';
                    setTimeout(() => { breathingPhase = 'inhale'; }, pattern.hold2 * 1000);
                }
            }, 1000);
        }

        function stopBreathingExercise() {
            if (breathingInterval) {
                clearInterval(breathingInterval);
                breathingInterval = null;
            }
        }

        function resetBreathingExercise() {
            stopBreathingExercise();
            coolDownSeconds = 0;
            breathingPhase = 'ready';
            const timer = document.getElementById('breathingTimer');
            const text = document.getElementById('breathingText');
            const circle = document.getElementById('breathingCircle');
            if (timer) timer.textContent = '00:00';
            if (text) text.textContent = 'Bereit?';
            if (circle) {
                circle.style.transform = 'scale(1)';
                circle.style.transition = 'transform 0.3s ease';
            }
        }

        // Stretch Timer Logic
        let stretchTimer = null;
        let stretchSeconds = 0;

        function startStretchTimer(duration) {
            if (!stretchTimer) {
                stretchSeconds = duration;
                stretchTimer = setInterval(() => {
                    stretchSeconds--;
                    const timer = document.getElementById('stretchTimer');
                    if (timer) timer.textContent = formatTime(stretchSeconds);
                    
                    if (stretchSeconds <= 0) {
                        pauseStretchTimer();
                        playSound();
                        alert('‚è∞ Zeit um! Gut gemacht! üí™');
                    }
                }, 1000);
            }
        }

        function pauseStretchTimer() {
            if (stretchTimer) {
                clearInterval(stretchTimer);
                stretchTimer = null;
            }
        }

        function resetStretchTimer(duration) {
            pauseStretchTimer();
            stretchSeconds = duration;
            const timer = document.getElementById('stretchTimer');
            if (timer) timer.textContent = formatTime(duration);
        }

        // Phase Timer Logic
        let phaseTimer = null;
        let phaseSeconds = 0;

        function startPhaseTimer(duration) {
            if (!phaseTimer) {
                phaseSeconds = duration;
                phaseTimer = setInterval(() => {
                    phaseSeconds--;
                    const timer = document.getElementById('phaseTimer');
                    if (timer) timer.textContent = formatTime(phaseSeconds);
                    
                    if (phaseSeconds <= 0) {
                        pausePhaseTimer();
                        playSound();
                        alert('‚è∞ Phase abgeschlossen! üí™');
                    }
                }, 1000);
            }
        }

        function pausePhaseTimer() {
            if (phaseTimer) {
                clearInterval(phaseTimer);
                phaseTimer = null;
            }
        }

        function resetPhaseTimer(duration) {
            pausePhaseTimer();
            phaseSeconds = duration;
            const timer = document.getElementById('phaseTimer');
            if (timer) timer.textContent = formatTime(duration);
        }

        // Navigation Functions
        function nextStretchExercise() {
            pauseStretchTimer();
            const phase = coolDownPrograms[currentCoolDown].phases[currentPhase];
            if (currentExerciseIndex < phase.exercises.length - 1) {
                currentExerciseIndex++;
                renderCoolDownPhase();
            }
        }

        function nextCoolDownPhase() {
            stopBreathingExercise();
            pauseStretchTimer();
            pausePhaseTimer();
            
            const program = coolDownPrograms[currentCoolDown];
            if (currentPhase < program.phases.length - 1) {
                currentPhase++;
                currentExerciseIndex = 0;
                renderCoolDownPhase();
            } else {
                completeCoolDown();
            }
        }

        function previousCoolDownPhase() {
            stopBreathingExercise();
            pauseStretchTimer();
            pausePhaseTimer();
            
            if (currentPhase > 0) {
                currentPhase--;
                currentExerciseIndex = 0;
                renderCoolDownPhase();
            }
        }

        function backToCoolDownSelection() {
            stopBreathingExercise();
            pauseStretchTimer();
            pausePhaseTimer();
            showCoolDownSelection();
        }

        function completeCoolDown() {
            stopBreathingExercise();
            pauseStretchTimer();
            pausePhaseTimer();
            
            alert('üéâ Cool-Down abgeschlossen!\n\nPerfekte Recovery! Du bist bereit f√ºr die n√§chste Session üí™');
            backToMenu();
        }

        // Helper Functions
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
        }

        function playSound() {
            // Simple beep using Web Audio API
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = 800;
                oscillator.type = 'sine';
                gainNode.gain.value = 0.3;
                
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 0.2);
            } catch (e) {
                console.log('Audio not supported');
            }
        }
    </script>
</body>
</html>
